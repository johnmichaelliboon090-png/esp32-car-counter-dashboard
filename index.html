<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Parking Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: #0d0f18;
    color: white;
    padding: 20px;
}

h1 { 
    text-align: center; 
    color: #00eaff;
    text-shadow: 0 0 15px #00eaff;
}

.grid {
    display: grid;
    gap: 20px;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
}

.card {
    background: #11141f;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 0 18px rgba(0, 238, 255, 0.3);
    border: 1px solid #00eaff60;
}

h2 {
    color: #00eaff;
    text-shadow: 0 0 10px #00eaff;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

th, td {
    border: 1px solid #00eaff50;
    padding: 10px;
    text-align: center;
}

th {
    background: #00eaff20;
}

.free {
    color: #00ff88;
    font-weight: bold;
}

.occupied {
    color: #ff3c3c;
    font-weight: bold;
}
</style>
</head>

<body>

<h1>Smart Parking Dashboard</h1>

<div class="grid">

    <div class="card">
        <h2>Total Cars Inside</h2>
        <h1 id="totalCars" style="font-size:45px;text-align:center;">0</h1>
    </div>

    <div class="card">
        <h2>Slot Status</h2>
        <p>Slot 1: <span id="slot1">Loading...</span></p>
        <p>Slot 2: <span id="slot2">Loading...</span></p>
        <p>Slot 3: <span id="slot3">Loading...</span></p>
        <p>Slot 4: <span id="slot4">Loading...</span></p>
    </div>

    <div class="card">
        <h2>Real-Time Car Count</h2>
        <canvas id="carChart"></canvas>
    </div>

    <div class="card" style="grid-column: span 2;">
        <h2>Live History</h2>
        <table>
            <thead>
                <tr>
                    <th>Slot</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="historyTable"></tbody>
        </table>
    </div>

</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>

<script>
// ---------------- FIREBASE CONFIG ----------------
const firebaseConfig = {
  apiKey: "AIzaSyBf1PpD2Td4gE0hXR_iBdz2Iv_kbiGV7Zo",
  authDomain: "parkinglot-faed9.firebaseapp.com",
  databaseURL: "https://parkinglot-faed9-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "parkinglot-faed9"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// UI Elements
const totalCars = document.getElementById("totalCars");
const slotEls = [
    document.getElementById("slot1"),
    document.getElementById("slot2"),
    document.getElementById("slot3"),
    document.getElementById("slot4")
];
const historyTable = document.getElementById("historyTable");

// ---------------- REALTIME LISTENER ----------------
db.ref("Parking").on("value", snapshot => {
    const data = snapshot.val();
    if (!data) return;

    let count = 0;
    historyTable.innerHTML = "";

    for (let i = 1; i <= 4; i++) {
        const sensor = data["Sensor" + i];
        if (!sensor) continue;

        const status = sensor.status || "Unknown";
        slotEls[i-1].innerText = status;
        slotEls[i-1].className = status === "Occupied" ? "occupied" : "free";

        if (status === "Occupied") count++;

        historyTable.innerHTML += `
            <tr>
                <td>${i}</td>
                <td class="${status === "Occupied" ? "occupied" : "free"}">
                    ${status}
                </td>
            </tr>
        `;
    }

    totalCars.innerText = count;
    updateGraph(count);
});

// ---------------- GRAPH ----------------
const ctx = document.getElementById("carChart").getContext("2d");
const carChart = new Chart(ctx, {
    type: "line",
    data: {
        labels: [],
        datasets: [{
            label: "Cars Inside",
            data: [],
            borderColor: "#00eaff",
            borderWidth: 3,
            tension: 0.3
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: { beginAtZero: true, stepSize: 1 }
        }
    }
});

function updateGraph(value) {
    if (carChart.data.labels.length > 15) {
        carChart.data.labels.shift();
        carChart.data.datasets[0].data.shift();
    }
    carChart.data.labels.push(new Date().toLocaleTimeString());
    carChart.data.datasets[0].data.push(value);
    carChart.update();
}
</script>

</body>
</html>
