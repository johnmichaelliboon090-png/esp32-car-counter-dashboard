<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Parking Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #0d0f18;
        color: white;
        padding: 20px;
    }

    h1 { 
        text-align: center; 
        color: #00eaff;
        text-shadow: 0 0 15px #00eaff;
    }

    .grid {
        display: grid;
        gap: 20px;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    }

    .card {
        background: #11141f;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 0 18px rgba(0, 238, 255, 0.3);
        border: 1px solid #00eaff60;
    }

    h2 {
        color: #00eaff;
        text-shadow: 0 0 10px #00eaff;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        color: white;
    }

    th, td {
        border: 1px solid #00eaff50;
        padding: 10px;
        text-align: center;
    }

    th {
        background: #00eaff20;
    }

</style>

</head>
<body>

<h1>Smart Parking Dashboard</h1>

<div class="grid">

    <div class="card">
        <h2>Total Cars Inside</h2>
        <h1 id="totalCars" style="font-size:45px;text-align:center;">0</h1>
    </div>

    <div class="card">
        <h2>Slot Status</h2>
        <p>Slot 1: <span id="slot1">Loading...</span></p>
        <p>Slot 2: <span id="slot2">Loading...</span></p>
        <p>Slot 3: <span id="slot3">Loading...</span></p>
        <p>Slot 4: <span id="slot4">Loading...</span></p>
    </div>

    <div class="card">
        <h2>Real-Time Car Count</h2>
        <canvas id="carChart"></canvas>
    </div>

    <div class="card" style="grid-column: span 2;">
        <h2>History Table</h2>
        <table>
            <thead>
                <tr>
                    <th>Slot</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody id="historyTable"></tbody>
        </table>
    </div>

</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>

<script>
// ---------------------- YOUR FIREBASE CONFIG ----------------------
const firebaseConfig = {
  apiKey: "AIzaSyBf1PpD2Td4gE0hXR_iBdz2Iv_kbiGV7Zo",
  authDomain: "parkinglot-faed9.firebaseapp.com",
  databaseURL: "https://parkinglot-faed9-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "parkinglot-faed9",
  storageBucket: "parkinglot-faed9.firebasestorage.app",
  messagingSenderId: "1045359755272",
  appId: "1:1045359755272:web:cf2263fe90db41b98c91bd",
  measurementId: "G-PE7YEMWZCC"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// UI Elements
const totalCars = document.getElementById("totalCars");
const slot1 = document.getElementById("slot1");
const slot2 = document.getElementById("slot2");
const slot3 = document.getElementById("slot3");
const slot4 = document.getElementById("slot4");
const historyTable = document.getElementById("historyTable");

// ---------------------- REAL-TIME LISTENER ----------------------
db.ref("parking").on("value", (snapshot) => {
    const data = snapshot.val();
    if (!data) return;

    slot1.innerText = data.slot1.status;
    slot2.innerText = data.slot2.status;
    slot3.innerText = data.slot3.status;
    slot4.innerText = data.slot4.status;

    totalCars.innerText = data.totalCars ?? 0;

    // History table
    historyTable.innerHTML = `
        <tr><td>1</td><td>${data.slot1.status}</td><td>${data.slot1.date}</td><td>${data.slot1.time}</td></tr>
        <tr><td>2</td><td>${data.slot2.status}</td><td>${data.slot2.date}</td><td>${data.slot2.time}</td></tr>
        <tr><td>3</td><td>${data.slot3.status}</td><td>${data.slot3.date}</td><td>${data.slot3.time}</td></tr>
        <tr><td>4</td><td>${data.slot4.status}</td><td>${data.slot4.date}</td><td>${data.slot4.time}</td></tr>
    `;

    updateGraph(data.totalCars);
});

// ---------------------- GRAPH ----------------------
const ctx = document.getElementById("carChart").getContext("2d");
const carChart = new Chart(ctx, {
    type: "line",
    data: {
        labels: [],
        datasets: [{
            label: "Cars Inside",
            data: [],
            borderColor: "#00eaff",
            borderWidth: 3,
            tension: 0.3
        }]
    },
    options: {
        responsive: true,
        scales: { y: { beginAtZero: true } }
    }
});

function updateGraph(value) {
    if (carChart.data.labels.length > 20) {
        carChart.data.labels.shift();
        carChart.data.datasets[0].data.shift();
    }
    carChart.data.labels.push(new Date().toLocaleTimeString());
    carChart.data.datasets[0].data.push(value);
    carChart.update();
}

</script>

</body>
</html>
